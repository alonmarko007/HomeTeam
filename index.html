<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>××¨×§×•×‘×™×¥' v31.31</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --p: #4a90e2; --success: #2ed573; --danger: #ff4757; --gold: #f1c40f; --bg: #f4f7f6; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: system-ui, -apple-system, sans-serif; }
        body { background: var(--bg); margin: 0; direction: rtl; user-select: none; color: #333; }
        .app { max-width: 500px; margin: 0 auto; min-height: 100vh; background: white; display: flex; flex-direction: column; box-shadow: 0 0 30px rgba(0,0,0,0.1); }
        .hidden { display: none !important; }
        
        .goal-card { background: #fff9e6; margin: 20px; padding: 20px; border-radius: 25px; border: 2px solid #fcebb6; }
        .progress-container { background: #eee; height: 20px; border-radius: 10px; margin: 12px 0; overflow: hidden; position: relative; }
        .progress-fill { background: linear-gradient(90deg, #2ed573, #7bed9f); height: 100%; width: 0%; transition: width 0.5s; }
        .progress-text { position: absolute; width: 100%; text-align: center; font-size: 0.8rem; font-weight: bold; line-height: 20px; top: 0; }

        .item-row { background: white; border: 1px solid #eee; border-radius: 15px; padding: 12px; margin-bottom: 8px; display: flex; align-items: center; }
        .item-info { flex-grow: 1; text-align: right; }
        
        .avatar { width: 65px; height: 65px; border-radius: 50%; border: 3px solid var(--p); display: flex; align-items: center; justify-content: center; font-size: 1.8rem; background: #fff; margin: 0 auto 5px; box-shadow: 0 3px 6px rgba(0,0,0,0.1); }
        .btn-main { background: #f1f2f6; border: 1px solid #ddd; padding: 12px; border-radius: 12px; width: 80%; margin: 10px auto; display: block; font-weight: bold; cursor: pointer; }
        
        .reset-link { color: #ff4757; font-size: 0.7rem; text-decoration: underline; background: none; border: none; cursor: pointer; margin-top: 10px; }
        .ver-footer { font-size: 0.75rem; color: #bbb; text-align: center; padding: 15px; background: #f9f9f9; margin-top: auto; }
    </style>
</head>
<body>

<div class="app">
    <div id="screen-lobby">
        <h1 style="text-align:center; margin-top:25px;">××¨×§×•×‘×™×¥' âœ¨</h1>
        <div class="goal-card">
            <div id="lb-goal-n" style="font-weight:bold; color:#d35400;">×”×™×¢×“ ×”××©×¤×—×ª×™:</div>
            <div class="progress-container">
                <div id="lb-goal-b" class="progress-fill"></div>
                <div id="lb-goal-s" class="progress-text">0 / 0</div>
            </div>
        </div>
        
        <div id="lb-kids" style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; padding:20px; min-height: 100px; background: #fff;">
            <p style="grid-column: 1/4; text-align:center; color:#999;">×˜×•×¢×Ÿ ×™×œ×“×™×...</p>
        </div>

        <button onclick="enterAdmin()" class="btn-main">âš™ï¸ × ×™×”×•×œ ×”×•×¨×™×</button>
        
        <div class="ver-footer">
            <div>×’×™×¨×¡×” v31.31</div>
            <button onclick="forceReset()" class="reset-link">×œ×—×¥ ×›××Ÿ ×× ×”×™×œ×“×™× × ×¢×œ××• (××™×¤×•×¡ × ×ª×•× ×™×)</button>
        </div>
    </div>

    <div id="screen-child" class="hidden" style="padding:20px; text-align:center;">
        <h2 id="ch-name"></h2>
        <div id="ch-list-t"></div>
        <button onclick="location.reload()" class="btn-main">ğŸ  ×—×–×¨×”</button>
    </div>
</div>

<script>
    const DB_KEY = 'MARKOVICH_FINAL_DB';
    
    const DEFAULTS = {
        children: [
            {id:1, name:"×¨× ×™", pin:"1234", points:0},
            {id:2, name:"××•×¤×™×¨", pin:"1234", points:0},
            {id:3, name:"××•×¨×™", pin:"1234", points:0}
        ],
        tasks: [{id:101, name:"×¦×—×¦×•×— ×©×™× ×™×™×", points:2, emoji:"ğŸ¦·"}],
        rewards: [{id:201, name:"×–××Ÿ ××¡×š", points:10, emoji:"ğŸ“±"}],
        pending: [],
        goal: { name: "×¢×¨×‘ ×¤×™×¦×”", target: 100, current: 0 }
    };

    let db;

    function loadData() {
        try {
            const data = localStorage.getItem(DB_KEY);
            if (!data) {
                db = JSON.parse(JSON.stringify(DEFAULTS));
            } else {
                db = JSON.parse(data);
                // ×× ×”× ×ª×•× ×™× ×§×™×™××™× ××‘×œ ×¨×©×™××ª ×”×™×œ×“×™× ×¨×™×§×” - ×ª×§×Ÿ ×–××ª
                if (!db.children || db.children.length === 0) {
                    db.children = JSON.parse(JSON.stringify(DEFAULTS.children));
                }
            }
        } catch(e) {
            db = JSON.parse(JSON.stringify(DEFAULTS));
        }
        renderLobby();
    }

    function renderLobby() {
        const kidsDiv = document.getElementById('lb-kids');
        if (!db.children || db.children.length === 0) {
            kidsDiv.innerHTML = "<p style='grid-column:1/4;'>×©×’×™××” ×‘×˜×¢×™× ×”. × ×¡×” ××™×¤×•×¡.</p>";
            return;
        }

        kidsDiv.innerHTML = db.children.map((c, i) => `
            <div onclick="kidLogin(${i})" style="text-align:center; cursor:pointer;">
                <div class="avatar">ğŸ‘¤</div>
                <b>${c.name}</b><br>
                <span style="color:var(--p); font-weight:bold;">${c.points} â­</span>
            </div>`).join('');

        const target = db.goal.target || 100;
        document.getElementById('lb-goal-b').style.width = Math.min((db.goal.current/target)*100, 100) + "%";
        document.getElementById('lb-goal-n').innerText = "×”×™×¢×“: " + db.goal.name;
        document.getElementById('lb-goal-s').innerText = db.goal.current + " / " + target;
    }

    function kidLogin(i) {
        const pin = prompt("×§×•×“ ×¢×‘×•×¨ " + db.children[i].name);
        if (pin === db.children[i].pin) {
            alert("×©×œ×•× " + db.children[i].name);
            // ×›××Ÿ ×™×‘×•× ×”××©×š ×”×œ×•×’×™×§×” ×©×œ ××¡×š ×”×™×œ×“
        }
    }

    function enterAdmin() {
        if (prompt("×¡×™×¡××”:") === "1234") {
            alert("× ×›× ×¡ ×œ× ×™×”×•×œ (×›××Ÿ ×™×•×¤×™×¢ ××¡×š ×”× ×™×”×•×œ ×”××œ× ×‘×§×•×“ ×”×¡×•×¤×™)");
        }
    }

    // ×¤×•× ×§×¦×™×™×ª ×”×§×¡× - ××•×—×§×ª ×”×›×œ ×•×˜×•×¢× ×ª ××—×“×©
    function forceReset() {
        if (confirm("×”×× ×œ××¤×¡ ××ª ×›×œ ×”× ×ª×•× ×™×? ×”×™×œ×“×™× ×•×”××©×™××•×ª ×™×—×–×¨×• ×œ×‘×¨×™×¨×ª ×”××—×“×œ.")) {
            localStorage.removeItem(DB_KEY);
            location.reload();
        }
    }

    // ×”×¤×¢×œ×”
    loadData();
</script>
</body>
</html>
